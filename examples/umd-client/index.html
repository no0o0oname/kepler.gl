<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>地理流可视化</title>

  <!--Uber Font-->
  <link rel="stylesheet" href="https://d1a3f4spazzrp4.cloudfront.net/kepler.gl/uber-fonts/4.0.0/superfine.css" />

  <!--MapBox css-->
  <link href="https:https://unpkg.com/maplibre-gl@^3/dist/maplibre-gl.css" rel="stylesheet" />

  <!-- Load React/Redux -->
  <script src="https://unpkg.com/react@18.2.0/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/redux@4.2.1/dist/redux.js" crossorigin></script>
  <script src="https://unpkg.com/react-redux@8.0.5/dist/react-redux.min.js" crossorigin></script>
  <script src="https://unpkg.com/styled-components@4.1.3/dist/styled-components.min.js" crossorigin></script>

  <!-- Load Kepler.gl-->
  <script src="https://unpkg.com/kepler.gl@3.0.0-alpha.2/umd/keplergl.min.js"></script>
  <!--If you want to load the build from filepath -->
  <!--<script src="../../umd/keplergl.min.js"></script>-->

  <style type="text/css">
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
  </style>

  <!--MapBox token-->
  <script>

    /**
     * Provide your json file name
     **/
    var json_file = 'bjss.json'

    /**
     * Provide your MapBox Token (Used in pre 3.x kepler.gl)
     **/
    const MAPBOX_TOKEN = 'pk.eyJ1IjoibjBuYW1lIiwiYSI6ImNqeXo1eG90ZDAzOWczaG54dGp4cWhlcmYifQ.xMyKDeImcCPf8nLij2YiHw';
    const WARNING_MESSAGE =
      'Please Provide a Mapbox Token in order to use Kepler.gl. Edit this file and fill out MAPBOX_TOKEN with your access key';

    /**
     * Theme customization
     **/
    const theme = {
      sidePanelBg: '#ffffff',
      titleTextColor: '#000000',
      sidePanelHeaderBg: '#f7f7F7',
      subtextColorActive: '#2473bd',
      tooltipBg: '#1869b5',
      tooltipColor: '#ffffff',
      dropdownListBgd: '#ffffff',
      textColorHl: '#2473bd',
      inputBgd: '#f7f7f7',
      inputBgdHover: '#ffffff',
      inputBgdActive: '#ffffff',
      dropdownListHighlightBg: '#f0f0f0',
      panelBackground: '#f7f7F7',
      panelBackgroundHover: '#f7f7F7',
      secondaryInputBgd: '#f7f7F7',
      secondaryInputBgdActive: '#f7f7F7',
      secondaryInputBgdHover: '#ffffff',
      panelActiveBg: '#f7f7F7'
    };

    const initialUiState = {
      // use Chinese locale
      locale: 'cn',

      // customize which map control button to show
      mapControls: {
        visibleLayers: {
          show: true
        },
        mapLegend: {
          show: true,
          active: false
        },
        toggle3d: {
          show: true
        },
        splitMap: {
          show: false
        },
        mapLocale: {
          show: true,
          active: false
        },
        mapDraw: {
          show: true
        }
      },

      currentModal: null
    };

    const localeMessages = {
      cn: {
        ['layerManager.addData']: '测试'
      },
      en: {
        ['layerManager.addData']: 'Add Data to Layer'
      }
    };
  </script>
</head>

<body>
  <!-- We will put our React component inside this div. -->
  <div id="app">
    <!-- Kepler.gl map will be placed here-->
  </div>

  <!-- Load our React component. -->
  <script>
    /* Validate Mapbox Token */
    if ((MAPBOX_TOKEN || '') === '' || MAPBOX_TOKEN === 'PROVIDE_MAPBOX_TOKEN') {
      alert(WARNING_MESSAGE);
    }

    /** STORE **/
    const reducers = (function createReducers(redux, keplerGl) {
      return redux.combineReducers({
        // mount keplerGl reducer
        keplerGl: keplerGl.keplerGlReducer
      });
    })(Redux, KeplerGl);

    const middleWares = (function createMiddlewares(keplerGl) {
      return keplerGl.enhanceReduxMiddleware([
        // Add other middlewares here
      ]);
    })(KeplerGl);

    const enhancers = (function craeteEnhancers(redux, middles) {
      return redux.applyMiddleware(...middles);
    })(Redux, middleWares);

    const store = (function createStore(redux, enhancers) {
      const initialState = {};

      return redux.createStore(reducers, initialState, redux.compose(enhancers));
    })(Redux, enhancers);
    /** END STORE **/

    /** COMPONENTS **/

    // define custom header factory
    function CustomPanelHeaderFactory(...deps) {
      const PanelHeader = KeplerGl.PanelHeaderFactory(...deps);
      const defaultActionItems = PanelHeader.defaultProps.actionItems;
      const logoComponent = PanelHeader.defaultProps.logoComponent;

      PanelHeader.defaultProps = {
        appName: '地理流可视化',
        logoComponent: () => {
          return logoComponent({
            appName: '地理流可视化',
            appWebsite: null,
            version: null
          })
        },
        actionItems: [
          {
            ...defaultActionItems.find(item => item.id === 'save'),
            id: 'save',
            tooltip: '保存地图',
            label: '保存',
            iconComponent: KeplerGl.Icons.Save,
            onClick: () => { }
          },
        ]
      };

      return PanelHeader;
    }
    CustomPanelHeaderFactory.deps = KeplerGl.PanelHeaderFactory.deps;


    const KeplerElement = (function (react, keplerGl, mapboxToken) {
      return function (props) {

        // Inject custom header into Kepler.gl,
        const CustomizedKeplerGl = keplerGl.injectComponents([
          [keplerGl.PanelHeaderFactory, CustomPanelHeaderFactory]
        ]);

        return react.createElement(
          'div',
          { style: { position: 'absolute', left: 0, width: '100vw', height: '100vh' } },
          react.createElement(CustomizedKeplerGl, {
            mapboxApiAccessToken: mapboxToken,
            id: 'map',
            theme: 'light',
            width: props.width || window.innerWidth,
            height: props.height || window.innerHeight,
            initialUiState: initialUiState,
            localeMessages: localeMessages
          })
        );
      };
    })(React, KeplerGl, MAPBOX_TOKEN);

    const app = (function createReactReduxProvider(react, reactRedux, KeplerElement) {
      return react.createElement(
        reactRedux.Provider,
        { store },
        react.createElement(KeplerElement, null)
      );
    })(React, ReactRedux, KeplerElement);
    /** END COMPONENTS **/

    /** Render **/
    (function render(react, reactDOM, app) {
      const container = document.getElementById('app');
      const root = reactDOM.createRoot(container);
      root.render(app);
    })(React, ReactDOM, app);
  </script>

  <!-- The next script will show how to interact directly with Kepler map store -->
  <script>
    /**
     * Customize map.
     * Interact with map store to customize data and behavior
     */
    (function customize(keplerGl, store) {
      // store.dispatch(keplerGl.toggleSplitMap());
    })(KeplerGl, store);
  </script>
</body>

</html>